"0","## Convert current data format for visualization"
"0",""
"0","viz_data <- index_data %>%"
"0","    select(-Spectra) %>% "
"0","    unnest(Indices) %>% "
"0","  "
"0","    select(-BandDefinition) %>%"
"0","    spread(Index, Value) %>%"
"0",""
"0","    # Select useful columns "
"0","    select(DateTime, Date, Site, Block, Treatment, Replicate, FileNum, NDVI, EVI, EVI2) %>%"
"0","  "
"0","    # Create additional columns "
"0","    mutate(Year = lubridate::year(DateTime),"
"0","           DOY = lubridate::yday(DateTime)) %>%"
"0","    rename(Time = DateTime) %>%"
"0","    mutate(Block = as.numeric(str_extract(Block, ""\\d""))) %>%"
"0","    mutate(Replicate = as.character(Replicate)) %>% "
"0","    mutate(collection_year = ""current"") %>% "
"0","  "
"0","    # remove non-data (ref, dark, throwaway) scans"
"0","    filter(!str_detect(Treatment, ""REF|DARK|THROWAWAY""))"
"0",""
"0","# Get relevant treatments and sites"
"0","viz_treatments <- viz_data$Treatment %>% unique()"
"0","viz_sites <- viz_data$Site   %>% unique()"
"0",""
"0","# Read data from past years"
"0","past_data <- (if (file.exists(""indices_2014-2019.updated.rds"")){"
"0","                   readRDS(""indices_2014-2019.updated.rds"")"
"0","                }else{"
"0","                   readRDS(selectFile(caption = ""Select Past years indices .rds file""))"
"0","                 })%>% "
"0","  "
"0","    # Standardize Site names from 2019 version to 2020 onwards"
"0","    mutate(Site = ifelse(Site %in% c(""WSG1"", ""WSG23""), ""WSG89"", Site))  %>%"
"0","    mutate(Site = ifelse(Site %in% c(""DHT""), ""DHT89"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""MAT""), ""MAT89"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""LMAT""), ""MAT06"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""HIST""), ""DHT89"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""SHB2""), ""SHB89"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""MNAT""), ""MNT97"", Site)) %>% "
"0","    mutate(Site = ifelse(Site %in% c(""NANT""), ""MNN97"", Site)) %>% "
"0","  "
"0","    # Label as previous years"
"0","    mutate(collection_year = ""Past"") %>% "
"0","  "
"0","  # Get relevant subset of data"
"0","  filter(Treatment %in% viz_treatments) %>% "
"0","  filter(Site %in% viz_sites) %>% "
"0","  filter(Year >= 2017) "
"2","Error in readRDS(selectFile(caption = ""Select Past years indices .rds file"")) : 
  bad 'file' argument
"
