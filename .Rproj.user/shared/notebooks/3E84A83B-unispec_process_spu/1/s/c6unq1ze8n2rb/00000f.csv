"0",""
"0","maxed_files <- raw_data %>% inner_join(spu_dataframe %>% select(spu_filename),by = ""spu_filename"") %>% # restrict to those w/.spu files"
"0","  unnest(Spectra) %>% "
"0","  filter(ChA > 65000 | ChB > 65000) %>% "
"0","  select(spu_filename) %>%"
"0","  unique()"
"0"," # summarize(maxed_number = n(), maxed_wavelengths = str_c(min(Wavelength), "" - "", max(Wavelength), collapse = "", ""))  "
"0",""
"0","if (nrow(maxed_files) > 0 ){"
"0","  max_data <- raw_data %>% "
"0","  filter(spu_filename %in% maxed_files$spu_filename) %>%"
"0","  unnest(Spectra) %>%"
"0","  mutate(Reflectance = ChB/ChA) %>% "
"0","  filter(Wavelength > 400, Wavelength < 1000)"
"0","  #Graph maxed out spectra"
"0"," (p1<-max_data %>% gather(key = Channel, value = Intensity, ChB, ChA) %>%"
"0","  gather(key = ref_part, value = Reflectance_Intensity, Intensity, Reflectance) %>% "
"0","  ggplot(mapping = aes(x = Wavelength, y = Reflectance_Intensity)) +"
"0","    geom_line(aes(color=Channel)) +"
"0","    facet_wrap(~ spu_filename, nrow = 4))"
"0","# Print MAXED files "
"0","  maxed_data <- max_data %>% "
"0","    filter(ChA > 65000 | ChB > 65000) %>% "
"0","    group_by(spu_filename) %>%"
"0","    summarize(number_of_maxed_wavelength = n(), maxed_wavelengths = str_c(min(Wavelength),"
"0","                                                "" - "", max(Wavelength), collapse = "", "")) "
"0","   # Maxed file list "
"0","  raw_data %>% select(spu_filename, Site, Date, Block, Treatment, Replicate) %>% "
"0","     inner_join(maxed_data,by = ""spu_filename"") %>%"
"0","     kable(align = ""c"", caption = ""Files with maxed out wavelegnth"" )"
"0",""
"0","  #if (menu(c(""Yes"", ""No""), title=""Replace maxed with NA?"",graphics = T)){"
"0","    raw_data <- raw_data %>%"
"0","      unnest(Spectra)%>%"
"0","      mutate(ChA = replace(ChA, ChA > 65000, NA), ChB = replace(ChB,ChB > 65000, NA)) %>%"
"0","      nest(Spectra = c(Wavelength, ChB, ChA))"
"0","  #}"
"0"," } else { print(""no maxed files"")}"
