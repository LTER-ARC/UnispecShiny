"0",""
"0","# This chunk output 2 tables. The overlap between ""field_keys"" and ""spu_dataframe"" finds any (a) missing raw .spu files OR (b) extra .spu files that aren't accounted for in the unispec field keys."
"0",""
"0","missing_info <- raw_data %>% "
"0","  filter(is.na(spu_filename) | "
"0","         is.na(Site) |"
"0","          # Block with NA's should always be REFS or EXTRA "
"0","         is.na(Block) & !str_detect(Treatment, ""REF|DARK|VEG"") | "
"0","          # Check for replicates with NA's that aren't REF"
"0","         is.na(Replicate) & !str_detect(Treatment, ""REF|DARK|THROWAWAY""),"
"0","         # don't care about EXTRA, VEG, or REF scans"
"0","         Treatment != ""EXTRA|VEG|REF"") %>%"
"0","   # reorder columns to see output better"
"0","  select(spu_filename, FileNum, Site, Block, Treatment, Replicate, everything())"
"0",""
"0","# Identify any files that aren't listed in the field key"
"0",""
"0","extra_files <- anti_join(spu_dataframe, field_keys,by = c(""Date"", ""FileNum"", ""Site"")) %>%"
"0","    pull(spu_filename)"
"0",""
"0","# Check File Number Pattern -- The number of files per block should be multiples of 5, with exception of REF or NA. "
"0","df_filenum_count <- field_keys %>% group_by(Site, Date, Block, Treatment) %>% "
"0","    summarize(Num_Files = n(),.groups = ""keep"") %>% # count the number of files"
"0","    filter(Num_Files %% 5 != 0) %>%   # files per plot"
"0","    # Remove scans that aren't of plot locations (DARK, REF, THROWAY)"
"0","    filter(Treatment != ""THROWAWAY"") %>% "
"0","    filter(Treatment != ""DARK"") %>% "
"0","    filter(! ""REF"" %in% Treatment)"
"0","# Check site names are equal in .spu files names and key file."
"0",""
"0","spu_sites <-  str_c(str_replace_na(unique(spu_dataframe$Site)), collapse = "","")"
"0","key_sites <-  str_c(str_replace_na(unique(field_keys$Site)), collapse = "","")"
"0",""
"0","# Create a multi-table kables object"
"0","check_tables <- kables("
"0","  list("
"0","    kable(tibble(Description=c(""Total number of .spu files: "","
"0","                               ""Total number of scans documented in key file: "","
"0","                     ""Scan Locations missing from key file: "",""Plots with scans not a multiple of 5: "","
"0","                     ""Sites from .spu file prefixes: "", ""Sites from key file:""),"
"0","       Value=c(nrow(spu_dataframe),nrow(field_keys),nrow(missing_info),NROW(extra_files),"
"0","               spu_sites,"
"0","               key_sites)"
"0","    )),"
"0",""
"0","  kable((raw_data %>% group_by(Date, Site, Block) %>%  "
"0","    filter(!is.na(Treatment)) %>% "
"0","    summarize(Treatments = str_c(str_replace_na(sort(unique(Treatment))), "
"0","                                 collapse = "",""), Num_Files = n(), .groups = ""keep"")), "
"0","    caption =""Number of files listed in field key"")"
"0","  ), caption = ""Checks on the number of files and sites"""
"0",")"
"0","check_tables"
